"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7814],{625:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"middleware/logger","title":"Logger","description":"Logger middleware","source":"@site/docs/middleware/logger.md","sourceDirName":"middleware","slug":"/middleware/logger","permalink":"/docs/middleware/logger","draft":false,"unlisted":false,"editUrl":"https://github.com/labstack/echox/blob/master/website/docs/middleware/logger.md","tags":[],"version":"current","frontMatter":{"description":"Logger middleware"},"sidebar":"docsSidebar","previous":{"title":"Key Auth","permalink":"/docs/middleware/key-auth"},"next":{"title":"Method Override","permalink":"/docs/middleware/method-override"}}');var n=r(4848),s=r(8453);const l={description:"Logger middleware"},a="Logger",i={},c=[{value:"RequestLogger middleware",id:"requestlogger-middleware",level:2},{value:"Examples",id:"examples",level:3},{value:"Troubleshooting Tips",id:"troubleshooting-tips",level:3},{value:"1. Solution for &quot;panic: missing LogValuesFunc callback function for request logger middleware&quot;",id:"1-solution-for-panic-missing-logvaluesfunc-callback-function-for-request-logger-middleware",level:4},{value:"2. If Parameters in Logs Are Empty",id:"2-if-parameters-in-logs-are-empty",level:4}];function g(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"logger",children:"Logger"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/labstack/echo/blob/master/middleware/request_logger.go",children:(0,n.jsx)(t.code,{children:"RequestLogger"})})," middleware logs the information about each HTTP request."]}),"\n",(0,n.jsx)(t.h2,{id:"requestlogger-middleware",children:"RequestLogger middleware"}),"\n",(0,n.jsx)(t.p,{children:"RequestLogger middleware allows developer fully to customize what is logged and how it is logged and is more suitable\nfor usage with 3rd party (structured logging) libraries."}),"\n",(0,n.jsxs)(t.p,{children:["You can quickly acquaint yourself with the values that the logger knows to extract by referring to the fields of the ",(0,n.jsx)(t.a,{href:"https://github.com/labstack/echo/blob/master/middleware/request_logger.go",children:(0,n.jsx)(t.code,{children:"RequestLoggerConfig"})})," structure below. Or click the link to view the most up-to-date details."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'type RequestLoggerConfig struct {\n\t// Skipper defines a function to skip middleware.\n\tSkipper Skipper\n\n\t// BeforeNextFunc defines a function that is called before next middleware or handler is called in chain.\n\tBeforeNextFunc func(c *echo.Context)\n\t// LogValuesFunc defines a function that is called with values extracted by logger from request/response.\n\t// Mandatory.\n\tLogValuesFunc func(c *echo.Context, v RequestLoggerValues) error\n\n\t// HandleError instructs logger to call global error handler when next middleware/handler returns an error.\n\t// This is useful when you have custom error handler that can decide to use different status codes.\n\t//\n\t// A side-effect of calling global error handler is that now Response has been committed and sent to the client\n\t// and middlewares up in chain can not change Response status code or response body.\n\tHandleError bool\n\n\t// LogLatency instructs logger to record duration it took to execute rest of the handler chain (next(c) call).\n\tLogLatency bool\n\t// LogProtocol instructs logger to extract request protocol (i.e. `HTTP/1.1` or `HTTP/2`)\n\tLogProtocol bool\n\t// LogRemoteIP instructs logger to extract request remote IP. See `echo.Context.RealIP()` for implementation details.\n\tLogRemoteIP bool\n\t// LogHost instructs logger to extract request host value (i.e. `example.com`)\n\tLogHost bool\n\t// LogMethod instructs logger to extract request method value (i.e. `GET` etc)\n\tLogMethod bool\n\t// LogURI instructs logger to extract request URI (i.e. `/list?lang=en&page=1`)\n\tLogURI bool\n\t// LogURIPath instructs logger to extract request URI path part (i.e. `/list`)\n\tLogURIPath bool\n\t// LogRoutePath instructs logger to extract route path part to which request was matched to (i.e. `/user/:id`)\n\tLogRoutePath bool\n\t// LogRequestID instructs logger to extract request ID from request `X-Request-ID` header or response if request did not have value.\n\tLogRequestID bool\n\t// LogReferer instructs logger to extract request referer values.\n\tLogReferer bool\n\t// LogUserAgent instructs logger to extract request user agent values.\n\tLogUserAgent bool\n\t// LogStatus instructs logger to extract response status code. If handler chain returns an echo.HTTPError,\n\t// the status code is extracted from the echo.HTTPError returned\n\tLogStatus bool\n\t// LogError instructs logger to extract error returned from executed handler chain.\n\tLogError bool\n\t// LogContentLength instructs logger to extract content length header value. Note: this value could be different from\n\t// actual request body size as it could be spoofed etc.\n\tLogContentLength bool\n\t// LogResponseSize instructs logger to extract response content length value. Note: when used with Gzip middleware\n\t// this value may not be always correct.\n\tLogResponseSize bool\n\t// LogHeaders instructs logger to extract given list of headers from request. Note: request can contain more than\n\t// one header with same value so slice of values is been logger for each given header.\n\t//\n\t// Note: header values are converted to canonical form with http.CanonicalHeaderKey as this how request parser converts header\n\t// names to. For example, the canonical key for "accept-encoding" is "Accept-Encoding".\n\tLogHeaders []string\n\t// LogQueryParams instructs logger to extract given list of query parameters from request URI. Note: request can\n\t// contain more than one query parameter with same name so slice of values is been logger for each given query param name.\n\tLogQueryParams []string\n\t// LogFormValues instructs logger to extract given list of form values from request body+URI. Note: request can\n\t// contain more than one form value with same name so slice of values is been logger for each given form value name.\n\tLogFormValues []string\n\n}\n'})}),"\n",(0,n.jsx)(t.h3,{id:"examples",children:"Examples"}),"\n",(0,n.jsxs)(t.p,{children:["Example for naive ",(0,n.jsx)(t.code,{children:"fmt.Printf"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'skipper := func(c *echo.Context) bool {\n\t// Skip health check endpoint\n    return c.Request().URL.Path == "/health"\n}\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogStatus: true,\n\tLogURI:    true,\n\tSkipper: skipper,\n\tBeforeNextFunc: func(c *echo.Context) {\n\t\tc.Set("customValueFromContext", 42)\n\t},\n\tLogValuesFunc: func(c *echo.Context, v middleware.RequestLoggerValues) error {\n\t\tvalue, _ := c.Get("customValueFromContext").(int)\n\t\tfmt.Printf("REQUEST: uri: %v, status: %v, custom-value: %v\\n", v.URI, v.Status, value)\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample output"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-exec",children:"REQUEST: uri: /hello, status: 200, custom-value: 42\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Example for slog (",(0,n.jsx)(t.a,{href:"https://pkg.go.dev/log/slog",children:"https://pkg.go.dev/log/slog"}),")"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'logger := slog.New(slog.NewJSONHandler(os.Stdout, nil))\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n    LogStatus:   true,\n    LogURI:      true,\n    LogError:    true,\n    HandleError: true, // forwards error to the global error handler, so it can decide appropriate status code\n    LogValuesFunc: func(c *echo.Context, v middleware.RequestLoggerValues) error {\n        if v.Error == nil {\n            logger.LogAttrs(context.Background(), slog.LevelInfo, "REQUEST",\n                slog.String("uri", v.URI),\n                slog.Int("status", v.Status),\n            )\n        } else {\n            logger.LogAttrs(context.Background(), slog.LevelError, "REQUEST_ERROR",\n                slog.String("uri", v.URI),\n                slog.Int("status", v.Status),\n                slog.String("err", v.Error.Error()),\n            )\n        }\n        return nil\n    },\n}))\n'})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample output"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-exec",children:'{"time":"2024-12-30T20:55:46.2399999+08:00","level":"INFO","msg":"REQUEST","uri":"/hello","status":200}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Example for Zerolog (",(0,n.jsx)(t.a,{href:"https://github.com/rs/zerolog",children:"https://github.com/rs/zerolog"}),")"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'logger := zerolog.New(os.Stdout)\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c *echo.Context, v middleware.RequestLoggerValues) error {\n\t\tlogger.Info().\n\t\t\tStr("URI", v.URI).\n\t\t\tInt("status", v.Status).\n\t\t\tMsg("request")\n\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample output"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-exec",children:'{"level":"info","URI":"/hello","status":200,"message":"request"}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Example for Zap (",(0,n.jsx)(t.a,{href:"https://github.com/uber-go/zap",children:"https://github.com/uber-go/zap"}),")"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'logger, _ := zap.NewProduction()\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c *echo.Context, v middleware.RequestLoggerValues) error {\n\t\tlogger.Info("request",\n\t\t\tzap.String("URI", v.URI),\n\t\t\tzap.Int("status", v.Status),\n\t\t)\n\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample output"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-exec",children:'{"level":"info","ts":1735564026.3197417,"caller":"cmd/main.go:20","msg":"request","URI":"/hello","status":200}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Example for Logrus (",(0,n.jsx)(t.a,{href:"https://github.com/sirupsen/logrus",children:"https://github.com/sirupsen/logrus"}),")"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'log := logrus.New()\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c *echo.Context, values middleware.RequestLoggerValues) error {\n\t\tlog.WithFields(logrus.Fields{\n\t\t\t"URI":   values.URI,\n\t\t\t"status": values.Status,\n\t\t}).Info("request")\n\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample output"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-exec",children:'time="2024-12-30T21:08:49+08:00" level=info msg=request URI=/hello status=200\n'})}),"\n",(0,n.jsx)(t.h3,{id:"troubleshooting-tips",children:"Troubleshooting Tips"}),"\n",(0,n.jsx)(t.h4,{id:"1-solution-for-panic-missing-logvaluesfunc-callback-function-for-request-logger-middleware",children:'1. Solution for "panic: missing LogValuesFunc callback function for request logger middleware"'}),"\n",(0,n.jsxs)(t.p,{children:["This panic arises when the ",(0,n.jsx)(t.code,{children:"LogValuesFunc"})," callback function, which is mandatory for the request logger middleware configuration, is left unset."]}),"\n",(0,n.jsxs)(t.p,{children:["To address this, you must define a suitable function that adheres to the ",(0,n.jsx)(t.code,{children:"LogValuesFunc"})," specifications and then assign it within the middleware configuration. Consider the following straightforward illustration:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:'func logValues(c *echo.Context, v middleware.RequestLoggerValues) error {\n    fmt.Printf("Request Method: %s, URI: %s\\n", v.Method, v.URI)\n    return nil\n}\n\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n    LogValuesFunc: logValues,\n}))\n'})}),"\n",(0,n.jsx)(t.h4,{id:"2-if-parameters-in-logs-are-empty",children:"2. If Parameters in Logs Are Empty"}),"\n",(0,n.jsxs)(t.p,{children:["When investigating logging-related glitches, if you notice that certain parameters like ",(0,n.jsx)(t.code,{children:"v.URI"})," and ",(0,n.jsx)(t.code,{children:"v.Status"})," within the ",(0,n.jsx)(t.code,{children:"LogValuesFunc"})," function produce empty outputs, your focus should shift to validating the relevant configuration elements. Specifically, check whether the corresponding items (such as ",(0,n.jsx)(t.code,{children:"LogStatus"}),", ",(0,n.jsx)(t.code,{children:"LogURI"}),", etc.) in ",(0,n.jsx)(t.code,{children:"e.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{...}))"})," have been erroneously set to ",(0,n.jsx)(t.code,{children:"false"})," or failed to activate properly due to miscellaneous factors. Ensure these configuration particulars are accurately configured so that the pertinent request and response data can be precisely logged."]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(g,{...e})}):g(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>l,x:()=>a});var o=r(6540);const n={},s=o.createContext(n);function l(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);