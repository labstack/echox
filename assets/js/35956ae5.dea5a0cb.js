"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5288],{9067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"middleware/csrf","title":"CSRF","description":"CSRF middleware","source":"@site/docs/middleware/csrf.md","sourceDirName":"middleware","slug":"/middleware/csrf","permalink":"/docs/middleware/csrf","draft":false,"unlisted":false,"editUrl":"https://github.com/labstack/echox/blob/master/website/docs/middleware/csrf.md","tags":[],"version":"current","frontMatter":{"description":"CSRF middleware"},"sidebar":"docsSidebar","previous":{"title":"CORS","permalink":"/docs/middleware/cors"},"next":{"title":"Decompress","permalink":"/docs/middleware/decompress"}}');var r=n(4848),i=n(8453);const s={description:"CSRF middleware"},a="CSRF",l={},c=[{value:"Usage",id:"usage",level:2},{value:"Custom Configuration",id:"custom-configuration",level:2},{value:"Usage with token based CSRF protection",id:"usage-with-token-based-csrf-protection",level:3},{value:"Accessing CSRF Token",id:"accessing-csrf-token",level:2},{value:"Server-side",id:"server-side",level:3},{value:"Client-side",id:"client-side",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Default Configuration",id:"default-configuration",level:3},{value:"Full example",id:"full-example",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"csrf",children:"CSRF"})}),"\n",(0,r.jsx)(t.p,{children:"Cross-site request forgery, also known as one-click attack or session riding and\nabbreviated as CSRF (sometimes pronounced sea-surf) or XSRF, is a type of malicious\nexploit of a website where unauthorized commands are transmitted from a user that\nthe website trusts."}),"\n",(0,r.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"e.Use(middleware.CSRF())\n"})}),"\n",(0,r.jsx)(t.h2,{id:"custom-configuration",children:"Custom Configuration"}),"\n",(0,r.jsxs)(t.p,{children:["The CSRF middleware supports the ",(0,r.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-Fetch-Site",children:(0,r.jsx)(t.strong,{children:"Sec-Fetch-Site"})})," header as a modern, defense-in-depth approach to ",(0,r.jsx)(t.a,{href:"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#fetch-metadata-headers",children:"CSRF\nprotection"}),", implementing the OWASP-recommended Fetch Metadata API alongside the traditional token-based mechanism."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"How it works:"})}),"\n",(0,r.jsxs)(t.p,{children:["Modern browsers automatically send the ",(0,r.jsx)(t.code,{children:"Sec-Fetch-Site"})," header with all requests, indicating the relationship\nbetween the request origin and the target. The middleware uses this to make security decisions:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"same-origin"})})," or ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"none"})}),": Requests are allowed (exact origin match or direct user navigation)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"same-site"})}),": Falls back to token validation (e.g., subdomain to main domain)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"cross-site"})}),": Blocked by default with 403 error for unsafe methods (POST, PUT, DELETE, PATCH)"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"For browsers that don't send this header (older browsers), the middleware seamlessly falls back to\ntraditional token-based CSRF protection."}),"\n",(0,r.jsxs)(t.p,{children:["For ",(0,r.jsx)(t.code,{children:"Sec-Fetch-Site"})," usage follow the configuration options:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"TrustedOrigins []string"}),": Allowlist specific origins for cross-site requests (useful for OAuth callbacks, webhooks)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"AllowSecFetchSiteFunc func(echo.Context) (bool, error)"}),": Custom logic for same-site/cross-site request validation"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'e.Use(middleware.CSRFWithConfig(middleware.CSRFConfig{\n  // Allow OAuth callbacks from trusted provider\n  TrustedOrigins: []string{"https://oauth-provider.com"},\n\n  // Custom validation for same-site requests\n  AllowSecFetchSiteFunc: func(c *echo.Context) (bool, error) {\n      // Your custom authorization logic here\n      return validateCustomAuth(c), nil\n      // return true, err  // blocks request with error\n      // return true, nil  // allows CSRF request through\n      // return false, nil // falls back to legacy token logic\n  },\n}))\n'})}),"\n",(0,r.jsx)(t.h3,{id:"usage-with-token-based-csrf-protection",children:"Usage with token based CSRF protection"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'e := echo.New()\ne.Use(middleware.CSRFWithConfig(middleware.CSRFConfig{\n  TokenLookup: "header:X-XSRF-TOKEN",\n}))\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Example above uses ",(0,r.jsx)(t.code,{children:"X-XSRF-TOKEN"})," request header to extract CSRF token."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Example Configuration that reads token from Cookie"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'middleware.CSRFWithConfig(middleware.CSRFConfig{\n\tTokenLookup:    "cookie:_csrf",\n\tCookiePath:     "/",\n\tCookieDomain:   "example.com",\n\tCookieSecure:   true,\n\tCookieHTTPOnly: true,\n\tCookieSameSite: http.SameSiteStrictMode,\n})\n'})}),"\n",(0,r.jsx)(t.h2,{id:"accessing-csrf-token",children:"Accessing CSRF Token"}),"\n",(0,r.jsx)(t.h3,{id:"server-side",children:"Server-side"}),"\n",(0,r.jsxs)(t.p,{children:["CSRF token can be accessed from ",(0,r.jsx)(t.code,{children:"Echo#Context"})," using ",(0,r.jsx)(t.code,{children:"ContextKey"})," and passed to\nthe client via template."]}),"\n",(0,r.jsx)(t.h3,{id:"client-side",children:"Client-side"}),"\n",(0,r.jsx)(t.p,{children:"CSRF token can be accessed from CSRF cookie."}),"\n",(0,r.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'type CSRFConfig struct {\n\t// Skipper defines a function to skip middleware.\n\tSkipper Skipper\n\t// TrustedOrigin permits any request with `Sec-Fetch-Site` header whose `Origin` header\n\t// exactly matches the specified value.\n\t// Values should be formated as Origin header "scheme://host[:port]".\n\t//\n\t// See [Origin]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin\n\t// See [Sec-Fetch-Site]: https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#fetch-metadata-headers\n\tTrustedOrigins []string\n\n\t// AllowSecFetchSameSite allows custom behaviour for `Sec-Fetch-Site` requests that are about to\n\t// fail with CRSF error, to be allowed or replaced with custom error.\n\t// This function applies to `Sec-Fetch-Site` values:\n\t// - `same-site` \t\tsame registrable domain (subdomain and/or different port)\n\t// - `cross-site`\t\trequest originates from different site\n\t// See [Sec-Fetch-Site]: https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#fetch-metadata-headers\n\tAllowSecFetchSiteFunc func(c *echo.Context) (bool, error)\n\n\t// TokenLength is the length of the generated token.\n\tTokenLength uint8\n\t// Optional. Default value 32.\n\n\t// TokenLookup is a string in the form of "<source>:<name>" or "<source>:<name>,<source>:<name>" that is used\n\t// to extract token from the request.\n\t// Optional. Default value "header:X-CSRF-Token".\n\t// Possible values:\n\t// - "header:<name>" or "header:<name>:<cut-prefix>"\n\t// - "query:<name>"\n\t// - "form:<name>"\n\t// Multiple sources example:\n\t// - "header:X-CSRF-Token,query:csrf"\n\tTokenLookup string `yaml:"token_lookup"`\n\n\t// Generator defines a function to generate token.\n\t// Optional. Defaults tp randomString(TokenLength).\n\tGenerator func() string\n\n\t// Context key to store generated CSRF token into context.\n\t// Optional. Default value "csrf".\n\tContextKey string\n\n\t// Name of the CSRF cookie. This cookie will store CSRF token.\n\t// Optional. Default value "csrf".\n\tCookieName string\n\n\t// Domain of the CSRF cookie.\n\t// Optional. Default value none.\n\tCookieDomain string\n\n\t// Path of the CSRF cookie.\n\t// Optional. Default value none.\n\tCookiePath string\n\n\t// Max age (in seconds) of the CSRF cookie.\n\t// Optional. Default value 86400 (24hr).\n\tCookieMaxAge int\n\n\t// Indicates if CSRF cookie is secure.\n\t// Optional. Default value false.\n\tCookieSecure bool\n\n\t// Indicates if CSRF cookie is HTTP only.\n\t// Optional. Default value false.\n\tCookieHTTPOnly bool\n\n\t// Indicates SameSite mode of the CSRF cookie.\n\t// Optional. Default value SameSiteDefaultMode.\n\tCookieSameSite http.SameSite\n\n\t// ErrorHandler defines a function which is executed for returning custom errors.\n\tErrorHandler func(c *echo.Context, err error) error\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"default-configuration",children:"Default Configuration"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'var DefaultCSRFConfig = CSRFConfig{\n\tSkipper:        DefaultSkipper,\n\tTokenLength:    32,\n\tTokenLookup:    "header:" + echo.HeaderXCSRFToken,\n\tContextKey:     "csrf",\n\tCookieName:     "_csrf",\n\tCookieMaxAge:   86400,\n\tCookieSameSite: http.SameSiteDefaultMode,\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"full-example",children:"Full example"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",metastring:"reference",children:"https://github.com/labstack/echox/blob/master/cookbook/csrf/main.go\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var o=n(6540);const r={},i=o.createContext(r);function s(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);