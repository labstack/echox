"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7814],{625:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>g});const n=JSON.parse('{"id":"middleware/logger","title":"Logger","description":"Logger middleware","source":"@site/docs/middleware/logger.md","sourceDirName":"middleware","slug":"/middleware/logger","permalink":"/docs/middleware/logger","draft":false,"unlisted":false,"editUrl":"https://github.com/labstack/echox/blob/master/website/docs/middleware/logger.md","tags":[],"version":"current","frontMatter":{"description":"Logger middleware"},"sidebar":"docsSidebar","previous":{"title":"Key Auth","permalink":"/docs/middleware/key-auth"},"next":{"title":"Method Override","permalink":"/docs/middleware/method-override"}}');var o=r(4848),s=r(8453);const l={description:"Logger middleware"},i="Logger",a={},g=[{value:"Old Logger middleware",id:"old-logger-middleware",level:2},{value:"Usage",id:"usage",level:2},{value:"Custom Configuration",id:"custom-configuration",level:2},{value:"Usage",id:"usage-1",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Default Configuration",id:"default-configuration",level:3},{value:"New RequestLogger middleware",id:"new-requestlogger-middleware",level:2},{value:"Examples",id:"examples",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"logger",children:"Logger"})}),"\n",(0,o.jsx)(t.p,{children:"Logger middleware logs the information about each HTTP request."}),"\n",(0,o.jsx)(t.p,{children:"Echo has 2 different logger middlewares:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Older string template based logger ",(0,o.jsx)(t.a,{href:"https://github.com/labstack/echo/blob/master/middleware/logger.go",children:(0,o.jsx)(t.code,{children:"Logger"})})," - easy to start with but has limited capabilities"]}),"\n",(0,o.jsxs)(t.li,{children:["Newer customizable function based logger ",(0,o.jsx)(t.a,{href:"https://github.com/labstack/echo/blob/master/middleware/request_logger.go",children:(0,o.jsx)(t.code,{children:"RequestLogger"})})," - allows developer fully to customize what is logged and how it is logged. Suitable for usage with 3rd party logger libraries."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"old-logger-middleware",children:"Old Logger middleware"}),"\n",(0,o.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"e.Use(middleware.Logger())\n"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Sample output"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'{"time":"2017-01-12T08:58:07.372015644-08:00","remote_ip":"::1","host":"localhost:1323","method":"GET","uri":"/","status":200,"error":"","latency":14743,"latency_human":"14.743\xb5s","bytes_in":0,"bytes_out":2}\n'})}),"\n",(0,o.jsx)(t.h2,{id:"custom-configuration",children:"Custom Configuration"}),"\n",(0,o.jsx)(t.h3,{id:"usage-1",children:"Usage"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'e.Use(middleware.LoggerWithConfig(middleware.LoggerConfig{\n  Format: "method=${method}, uri=${uri}, status=${status}\\n",\n}))\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Example above uses a ",(0,o.jsx)(t.code,{children:"Format"})," which logs request method and request URI."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Sample output"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"method=GET, uri=/, status=200\n"})}),"\n",(0,o.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'// LoggerConfig defines the config for Logger middleware.\nLoggerConfig struct {\n  // Skipper defines a function to skip middleware.\n  Skipper Skipper\n\n  // Tags to construct the logger format.\n  //\n  // - time_unix\n  // - time_unix_milli\n  // - time_unix_micro\n  // - time_unix_nano\n  // - time_rfc3339\n  // - time_rfc3339_nano\n  // - time_custom\n  // - id (Request ID)\n  // - remote_ip\n  // - uri\n  // - host\n  // - method\n  // - path\n  // - protocol\n  // - referer\n  // - user_agent\n  // - status\n  // - error\n  // - latency (In nanoseconds)\n  // - latency_human (Human readable)\n  // - bytes_in (Bytes received)\n  // - bytes_out (Bytes sent)\n  // - header:<NAME>\n  // - query:<NAME>\n  // - form:<NAME>\n  //\n  // Example "${remote_ip} ${status}"\n  //\n  // Optional. Default value DefaultLoggerConfig.Format.\n  Format string `yaml:"format"`\n\n  // Optional. Default value DefaultLoggerConfig.CustomTimeFormat.\n  CustomTimeFormat string `yaml:"custom_time_format"`\n\n  // Output is a writer where logs in JSON format are written.\n  // Optional. Default value os.Stdout.\n  Output io.Writer\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"default-configuration",children:"Default Configuration"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'DefaultLoggerConfig = LoggerConfig{\n  Skipper: DefaultSkipper,\n  Format: `{"time":"${time_rfc3339_nano}","id":"${id}","remote_ip":"${remote_ip}",` +\n    `"host":"${host}","method":"${method}","uri":"${uri}","user_agent":"${user_agent}",` +\n    `"status":${status},"error":"${error}","latency":${latency},"latency_human":"${latency_human}"` +\n    `,"bytes_in":${bytes_in},"bytes_out":${bytes_out}}` + "\\n",\n  CustomTimeFormat: "2006-01-02 15:04:05.00000",\n}\n'})}),"\n",(0,o.jsx)(t.h2,{id:"new-requestlogger-middleware",children:"New RequestLogger middleware"}),"\n",(0,o.jsx)(t.p,{children:"RequestLogger middleware allows developer fully to customize what is logged and how it is logged and is more suitable\nfor usage with 3rd party (structured logging) libraries."}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"https://github.com/labstack/echo/blob/master/middleware/request_logger.go",children:(0,o.jsx)(t.code,{children:"RequestLoggerConfig"})})," structure fields for values that logger knows to extract."]}),"\n",(0,o.jsx)(t.h3,{id:"examples",children:"Examples"}),"\n",(0,o.jsxs)(t.p,{children:["Example for naive ",(0,o.jsx)(t.code,{children:"fmt.Printf"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'e.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogStatus: true,\n\tLogURI:    true,\n\tBeforeNextFunc: func(c echo.Context) {\n\t\tc.Set("customValueFromContext", 42)\n\t},\n\tLogValuesFunc: func(c echo.Context, v middleware.RequestLoggerValues) error {\n\t\tvalue, _ := c.Get("customValueFromContext").(int)\n\t\tfmt.Printf("REQUEST: uri: %v, status: %v, custom-value: %v\\n", v.URI, v.Status, value)\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Example for slog (",(0,o.jsx)(t.a,{href:"https://pkg.go.dev/log/slog",children:"https://pkg.go.dev/log/slog"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'logger := slog.New(slog.NewJSONHandler(os.Stdout, nil))\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n    LogStatus:   true,\n    LogURI:      true,\n    LogError:    true,\n    HandleError: true, // forwards error to the global error handler, so it can decide appropriate status code\n    LogValuesFunc: func(c echo.Context, v middleware.RequestLoggerValues) error {\n        if v.Error == nil {\n            logger.LogAttrs(context.Background(), slog.LevelInfo, "REQUEST",\n                slog.String("uri", v.URI),\n                slog.Int("status", v.Status),\n            )\n        } else {\n            logger.LogAttrs(context.Background(), slog.LevelError, "REQUEST_ERROR",\n                slog.String("uri", v.URI),\n                slog.Int("status", v.Status),\n                slog.String("err", v.Error.Error()),\n            )\n        }\n        return nil\n    },\n}))\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Example for Zerolog (",(0,o.jsx)(t.a,{href:"https://github.com/rs/zerolog",children:"https://github.com/rs/zerolog"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'logger := zerolog.New(os.Stdout)\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c echo.Context, v middleware.RequestLoggerValues) error {\n\t\tlogger.Info().\n\t\t\tStr("URI", v.URI).\n\t\t\tInt("status", v.Status).\n\t\t\tMsg("request")\n\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Example for Zap (",(0,o.jsx)(t.a,{href:"https://github.com/uber-go/zap",children:"https://github.com/uber-go/zap"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'logger, _ := zap.NewProduction()\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c echo.Context, v middleware.RequestLoggerValues) error {\n\t\tlogger.Info("request",\n\t\t\tzap.String("URI", v.URI),\n\t\t\tzap.Int("status", v.Status),\n\t\t)\n\n\t\treturn nil\n\t},\n}))\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Example for Logrus (",(0,o.jsx)(t.a,{href:"https://github.com/sirupsen/logrus",children:"https://github.com/sirupsen/logrus"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'log := logrus.New()\ne.Use(middleware.RequestLoggerWithConfig(middleware.RequestLoggerConfig{\n\tLogURI:    true,\n\tLogStatus: true,\n\tLogValuesFunc: func(c echo.Context, values middleware.RequestLoggerValues) error {\n\t\tlog.WithFields(logrus.Fields{\n\t\t\t"URI":   values.URI,\n\t\t\t"status": values.Status,\n\t\t}).Info("request")\n\n\t\treturn nil\n\t},\n}))\n'})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>l,x:()=>i});var n=r(6540);const o={},s=n.createContext(o);function l(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);